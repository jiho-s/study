## HTTP 메시지

- HTTP 메시지의 세 부분
- 요청 메시지가 지원하는 여러 메서드
- 응답 메시지가 반환하는 여러 상태 코드
- 여러 HTTP 헤더들의 역할

### 메시지의 각 부분

HTTP 메시지는 단순한, 데이터의 구조화된 블록이다. 시작줄과 헤더는 'CRLF'로 나뉜다. 본문을 데이터를 포함하거나 비어있을 수도 있으며 헤더 다음 빈 줄 이후에 포함될 수 있다

#### 메시지 문법

HTTP 메시지는 요청 메시지나 응답 메시지로 분류된다

**요청 메시지 형식**

```http
POST /hello.txt HTTP/1.1
Host: naver.com

<html> </html>
```

```
<메서드> <요청 URL> <버전>
<헤더>

<본문>
```

**응답 메시지의 형식**

```http
HTTP/1.1 200 OK
Content-type: text/plain

Hi~
```

```
<버전> <상태코드> <사유 구절>
<헤더>

<본문>
```

##### 메서드

GET, POST, HEAD 등

##### 헤더

이름, 콜론(:), 공백, 값, 'CRLF'가 순서대로 0개이상 반복

### 메서드

#### 안전한 메서드

HTTP 요청의 결과로 서버에 어떤 작용도 없음을 의미 GET, HEAD 가 있다

#### HEAD

GET 처럼 행동하지만 응답으로 헤더만 돌려주고, 엔티티 본문은 반환되지 않는다

- 리소스를 가져오지 않고도 그에 대해 무엇인가를 알아낼수 있다
- 응답의 상태코드를 통해 개체가 존재하는지 확인할 수 있다
- 헤더를 확인하여 리소스가 변경되었는지 검사할 수 있다

HTTP/1.1 준수를 위해서는 HEAD 메서드가 반드시 구현되어 있어야한다

#### PUT

서버가 요청의 본문을 가지고 요청 URL 의 이름대로 새 문서를 만들거나 이미 URL 이 존재한다면 본문을 사용해서 교체하는 것이다

#### POST

서버에 입력 데이터를 전송하기 위해 설계 되었다.

> POST 는 서버에 데이터를 보내기 위해 사용, PUT 은 서버에 있는 리소스에 데이터를 입력하기 위해 사용

#### TRACE

클라이언트에게 자신의 요청이 서버에 도달했을 때 어떻게 보이게 되는지 알려준다. TRACE 요청은 서버에서 루프백 진단을 시작한다. 마지막 단계에 있는 서버는 자신이 받은 요청 메시지를 본문에 넣어 TRACE 응답으로 되돌려준다. 중간 애플리케이션에서 여러 다른 종류의 요청들을 일관되게 다룬다고 가정하는 문제가 있다(GET 은 캐시 등 다르게 처리할 수 있다) TRACE 요청은 어떠한 엔티티 본문도 보낼수 없다

####  OPTIONS

서버에게 특정 리소스에 대해 어떤 메서드가 지원되는지 물어볼 수 있다

#### DELETE

서버에게 요청 URL로 지정한 리소스를 삭제할 것을 요구

#### 확장 메서드

HTTP/1.1 명세에 정의되지 않은 메서드

### 상태코드

#### 100-199: 정보성 상태코드

| 상태 코드 | 사유 구절           | 의미                                                         |
| --------- | ------------------- | ------------------------------------------------------------ |
| 100       | Continue            | 요청의 시작 부분 일부가 받아들여졌으며 클라이언트는 나머지를 계속 보내야 함을 의미한다 |
| 101       | Switching Protocols | 클라이언트가 Upgrade 헤더에 나열한 것 중 하나로 서버가 프로토콜을 바꾸었음을 의미한다 |

> **Expect 헤더**
>
> 서버가 어떻게 동작하기를 기대하고 있는지 알려주기 위해 클라이언트가 사용한다. 만약 서버가 Expect 헤더의 값을 이해하지 못한다면 417 Expectation Failed 상태 코드로 응답해야 한다
>
> Expect: 100-continue

#####  100 Continue

클라이언트 애플리케이션이 서버에 엔티티 본문을 전송하기 전에 그 엔티티 본문을 서버가 받아들일 것인지 확인하려고 할때 확인 작업을 최적화하기 위한 의도로 도입

###### 클라이언트

클라이언트는 값을 100-continue 로 하는 Expect 요청 헤더를 보내야한다

###### 서버

100-continue 값이 담긴 Epxect 헤더가 포함된 요청을 받는다면 100 COntinue 응답 혹은 에러코드로 답해야 한다. 

###### 프락시

다음 홉 서버가 HTTP/1.1을 따르거나 어떤 버전을 따르는지 모른다면 요청을 전달하고 다음홉 서버가 1.1 보다 이전 버전의 HTTP 를 따른 다면 417 Expectation Failed 에러로 응답해야한다 

#### 200-299: 성공 상태 코드

| 상태 코드 | 사유 구절                    | 의미                                                         |
| --------- | ---------------------------- | ------------------------------------------------------------ |
| 200       | OK                           | 요청은 정상이고 엔티티 본문을 요청된 리소스를 포함하고 있다  |
| 201       | Created                      | 응답은 리소스에 대한 최대한 구체적인 참조가 담긴 Location 헤더와 함께 그 리소스를 참조할 수 있는 여러 URL 을 엔티티 본문에 포함해야 한다 |
| 202       | Accepted                     | 요청은 받아들여졌으나 서버는 아직 그에 대한 어떤 동작도 수행하지 않았다 |
| 203       | Non-Authoritative Infomation | 엔티티 해더에 들어있는 정보가 원래 서버가 아닌 리소스의 사본에서 왔다. 선택사항 |
| 204       | No Content                   | 엔티티 본문이 없음 폼을 리프레시 할때 사용                   |
| 205       | Reset Content                | 브라우저에게 현재 페이지에 있는 HTML 폼에 채워진 모든 값을 비우라고 말한다 |
| 206       | Partial Content              | 부분 혹은 범위 요청이 성공했다. Content-Rage 와 Date 헤더를 반드시 포함해야 하며, Etag, Content-Location 중 하나의 헤더도 반드시 포함해야 한다 |

#### 300-399: 리다이렉션 상태코드

클라이언티가 관심있어 하는 리소스에 대해 다른 위치를 사용하라고 말해주거나 그 리소스의 내용 대신 다른 대안 응답을 제공한다. 만약 리소스가 옮겨 졌다면 리다이렉션 상태코드와 Location 헤더를 보낼수 있다. 리다이렉션 상태 코드 중 몇몇은 리소스에 대한 애플리케이션의 로컬 복사본이 원래 서버와 비교했을 때 유효한지 확인하기 위해 사용된다.(If-Modified_since 헤더 전송)

302,303,307 은 비슷하지만 HTTP/1.0, HTTP/1.1 애플리케이션이 이 상태 코드를 다루는 방식의 차이점에 기인한다

#### 400-499: 클라이언트 에러 상태 코드

클라이언트가 서버가 다룰수 없는 무엇인가를 보냈을 때 사용

#### 500-599: 서버 에러 상태 코드

클라이언트가 서버의 제한에 걸린 것, 게이트웨이 리소스와 같은 서버의 보조 구성요소에서 발생 등 할 수 있다

### 헤더

헤더와 메서드는 클라이언트와 서버가 무엇을 하는지 결정하기 위해 함께 사용된다

헤더에는 특정 종류의 메시지에만 사용할 수 있는 헤더와 더 일반 목적으로 사용할 수 있는 헤더, 그리고 응답 요청 메시지 양쪽 모두에서 정보를 제공하는 헤더 등이 있다

**일반 헤더**

클라이언트와 서버 양쪽 모두가 사용한다

```
Date: Tue, 3 Out 1974 02:16:00 GMT
```

**요청 헤더**

요청 메시지를 위한 헤더이다. 서버에게 클라이언트가 받고자 하는 데이터의 타입이 무엇인지와 같은 부가 정보를 제공한다

```
Accept: */*
```

**응답 헤더**

클라이언트에게 정보를 제공하기 위한 헤더

```
Server: Tiki-Hut/1.0
```

**엔티티 헤더**

엔티티 본문에 데한 헤더를 말한다

```
Content-Type: text/html; charset=iso-latin-1
```

**확장 헤더**

HTTP 명세에 추가되지 않은 비표준 헤더

#### 일반 헤더

| 헤더         | 설명                                         |
| ------------ | -------------------------------------------- |
| Connection   | 클라이언트와 서버가 요청/응답에대한 옵션지정 |
| Date         | 날짜와 시간                                  |
| MIME-Version | MIME 의 버전을 알려준다                      |
|              |                                              |
|              |                                              |
|              |                                              |
|              |                                              |

##### 일반 캐시해더

7장에서 자세히 배움

#### 요청 헤더

요청 메시지에서만 의미를 갖는 헤더

| 헤더 | 설명                                              |
| ---- | ------------------------------------------------- |
| From | 클라이언트 사용자의 메일 주소                     |
| Host | 요청의 대상이 되는 서버의 호스트 명과 포트를 준다 |

##### Accept 관련 헤더

클라이언트가 무엇을 원하고 무엇을 할 수 있는지 원치 않는 것은 무엇인지 알려줄 수 있다

| 헤더              | 설명                                                         |
| ----------------- | ------------------------------------------------------------ |
| Expect            | 요청에 필요한 서버의 행동 열거                               |
| If-Modified-Since | 주어진 날짜 이후에 리소스가 변경되지 않았다면 요청을 제한한다 |

##### 요청 보안 헤더

요청하는 클라이언트가 어느 정도의 리소스에 접근하기 전에 자신을 인증

| 헤더          | 설명                            |
| ------------- | ------------------------------- |
| Authorization | 인증 그 자체에 대한 정보        |
| Cookie        | 서버에게 토큰을 전달 할 때 사용 |

##### 프락시 요청헤더

프락시의 기능을 돕기 위한 헤더, 6장에서 자세히 다룸

| 헤더                | 설명                                       |
| ------------------- | ------------------------------------------ |
| Max-Forwards        | 전달될 수 있는 최대 횟수 TRACE와 함께 사용 |
| Proxy-Authorization | 프록시 인증                                |

#### 응답 헤더

클라이언트에게 부가 정보를 제공한다

| 헤더   | 설명                            |
| ------ | ------------------------------- |
| Server | 서버 어플리케이션의 이름과 버전 |

##### 협상 헤더

| 헤더         | 설명               |
| ------------ | ------------------ |
| Accept-Range | 서버가 자원에 대해 |

##### 응답 보안 헤더

| 헤더       | 설명                                                         |
| ---------- | ------------------------------------------------------------ |
| Set-Cookie | 서버가 클라이언트를 인증할 수 있도록 클라이언트 측에 토클을 설정하기 위해 사용한다 |

#### 엔티티 헤더

엔티티에 대해 설명하는 헤더. 요청과 응답 양쪽 모두 엔티티를 포함할 수 있다.

| 헤더     | 설명                                                         |
| -------- | ------------------------------------------------------------ |
| Allow    | 엔티티에 대해 수행될 수 있는 요청 메서드들을 나열한다        |
| Location | 클라이언트에게 엔티티가 실제로 어디에 위치하고 있는지 말해준다. |

##### 콘텐츠 헤더

콘텐츠에 대한 구체적인 정보

| 헤더             | 설명                           |
| ---------------- | ------------------------------ |
| Content-Encoding | 본문에 적용된 어떤 인코딩      |
| Content-Type     | 이 본문이 어떤 종류의 객체인지 |

##### 엔티티 캐싱 헤더

엔티티 캐싱에 대한 정보를 제공한다. 리소스에 데헤 캐시된 사본이 아직 유효한지에 대한 정보와 캐시된 리소스가 더 이상 유효하지 않게 되는 시점을 다 잘 추정하기 위한 단서 이다

| 헤더 | 설명        |
| ---- | ----------- |
| ETag | 엔티티 태그 |
|      |             |

