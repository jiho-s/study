## 프레임

프레임은 데이터를 저장하거나, 동적링킹 메소드 값 반환 예외처리 실행을 위해 사용된다.

메소드가 호출될때마다 새로운 프레임이 생성되며 메소드가 정상종료든 아니든 메소드가 종료되면 사라진다. 프레임은 프레임을 생성하는 스레드의 JVM 스레드 스택에 할당된다. 각 프레임은 고유한 지역 변수 배열, 피연산자 스택, 그리고 현재 메소드의 클래스에 대한 런타임 상수 풀에 대한 참조를 포함한다

지역 변수 배열 및 피연산자 스택의 크기는 컴파일 타임에 결정되며 프레임과 관련된 메소드 코드와 함께 제공된다. 따라서 프레임 데이터 구조의 크기는 Java Virtual Machine의 구현에만 의존하며 이러한 구조의 메모리는 메서드 호출시 동시에 할당 된다.

어느 시점에서든 오직 하나의 프레임만 스레드가 제어할수 있다. 이 프레임을 *current frame* 이라고 하며 그 메소드를 *current method*  라고 한다. 현재 메소드가 정의 된 *class* 는 *current class* 다. 로컬 변수 및 피연산자 스택에 대한 연산은 일반적으로 현재 프레임을 참조합니다.

현재 메소드가 다른 메소드를 호출하거나 메소드가 완료되면 프레임은 current 상태가 아니다. 메서드가 호출되면 새 프레임이 만들어지고 제어가 새 메서드로 이동 되면 새 프레임이 현재 프레임이된다. 메서드 반환시 현재 프레임은 메서드 호출의 결과를 이전 프레임으로 다시 전달합니다. 그러면 이전 프레임이 현재 프레임이되고 현재 프레임이 삭제된다.

스레드에 의해 생성 된 프레임은 해당 스레드에 지역적이며 다른 스레드에서 참조 할 수 없다.

### 지역 변수

각 프레임은 지역변수라 불리는 변수 배열을 가지고 있다. 프레임의 지역 변수 배열의 길이는 컴파일 타임에 결정되고 프레임과 관련된 메서드에 대한클래스 또는 인터페이스의  코드와 함께 이진 표현으로 제공된다.

싱글 지역 변수는  `boolean`, `byte`, `char`, `short`, `int`, `float`, `reference`, `returnAddress`타입의 값을 포함할 수 있으며, 두개의 지역변수는 `long`, `double`  타입의 값을 포함할 수 있다.

지역 변수는 인덱싱으로 처리된다. 첫 번째 지역 변수의 인덱스는 0입니다.  `long` 타입 또는 `double` 타입의 값은 두 개의 연속적인 지역 변수를 차지한다. 이러한 값은 더 작은 번호를 사용해서 접근할 수 있다.

Java Virtual Machine은 지역 변수를 사용하여 메소드 호출시 매개 변수를 전달한다. 클래스 메서드 호출시 모든 매개 변수는 지역 변수 *0* 에서 시작하는 연속적인 지역 변수로 전달한다 . 인스턴스 메소드 호출에서 지역 변수 *0* 은 항상 인스턴스 메소드가 호출되는 객체에 대한 참조(`this`) 를 전달하는 데 사용된다. 이후에 모든 매개 변수는 지역 변수 *1* 부터 시작하는 연속적인 지역 변수로 전달된다.

### 피연산자 스택

각 프레임에는 *피연산자 스택으로* 알려진 후입선출(LIFO) 스택이 포함되어 있습니다 . 프레임 피연산자 스택의 최대 크기는 컴파일 타임에 결정되며 프레임과 관련된 메서드에 대한 코드와 함께 제공된다.

피연산자 스택은 이를 포함하는 프레임이 생성될 때는 비어있다. Java Virtual Machine은 로컬 변수 또는 필드에서 피연산자 스택으로 상수 또는 값을로드하는 명령어를 제공한다. 다른 Java Virtual Machine 명령어는 피연산자 스택에서 피연산자를 가져 와서 연산 한 후 결과를 다시 피연산자 스택으로 푸시한다. 피연산자 스택은 메서드에 전달할 매개 변수를 준비하고 메서드 결과를 수신하는데도 사용된다.

### 동적 링킹

각 프레임에는 메서드 코드의 *동적 연결* 을 지원하기 위해 현재 메서드 타입에 대한 Run-Time Constant Pool에 대한 주소가 포함되어 있다. 메서드에 대한 class 파일 코드에는 호출 할 메서드, 접근해야할 변수를 심볼릭 참조를 통해 나타낸다. 동적 연결은 이러한 심볼릭 메서드 참조를 구체적인 메서드 참조로 변환하고, 아직 정의되지 않은 심볼릭을 해결하는 데 필요한 클래스를로드하고,  접근할 변수의 런타임 위치와 관련된 적절한 오프셋으로 변수 접근을 변환한다.