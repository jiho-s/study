## Garbage Collector Implementation

### 세대별 가비지 수집

객체는 가비지로 간주되며, 실행중인 프로그램이 더 이상 참조 할 수 없으면 VM이 객체의 메모리를 재사용 할 수 있다.

가장 간단한 가비지 수집 알고리즘은 매번 실행시 참조 할 수 없는 객체의 메모리를 재사용하는 것이다. 살아 있는 객체의 수가 많아 질수록 가비지 수집이 걸리는 시간이 증가하므로 대규모 프로그램에서는 사용하면 안된다.

Java HotSpot VM은 여러개의 가비지 수집 알고리즘을 사용하는데 모든 가비지 수집 알고리즘은 세대별 수집이라는 기술을 사용한다. 

세대별 가비지 수집은 관찰 결과 알게된 몇가지 속성을 사용하여 사용되지 않는 객체 회수하는데 필요한 작업을 최소화한다. 이 중 가장 중요한 속성은 약한 세대별 가설이다.

##### 약한세대별가설

거의 대부분의 객체는 아주 짧은 시간만 살아 있는다

대부분의 객체가 단명한다는 사실에 초점을 맞추면 효율적인 수집이 가능하다.

### 세대

약한 세대별 가설을 적용하기위해 메모리는 세대로 관리된다. 가비지 수집은 각각의 세대가 가득차면 발생한다.

대부분의 객체는 young generation 전용 풀에 할당되며, 대부분의 객체는 그곳에서 죽는다. young generation 풀이 가득차면 young generation 만 수집되는 *마이너컬렉션* 이 발생한다. 마이너 컬렉션 중에 young generation에서 살아남은 몇몇 객체는 old generation으로 이동한다. old generation이 가득 차게 되면 메이저 컬렉션이 발생하게 된다.

자바 heap을 포함하는 전체 주소공간은 young generation과 old generation을 나뉜다.

young generation은 다시 에덴과 두개의 서바이버 영역으로 나뉘는데 대부분의 객체는 초기에 에덴에 할당된다. 

서바이버 영역 중 하나는 언제나 비워 있으며 에덴 영역에서 살아남은 객체들과 다른 서바이버 영역에서 살아남은 객체를 받는다. 가비지 수집 이후 에덴과 서바이버 영역 중 하나는 비워진다. 다음 가비지 수집에는 두개의 서바이버 영역의 역할이 바뀐다. 객체는 특정횟수만큼 살아남기 이전에는 이러한 방식으로 서바이버 영역에서 이동한다. 이런 객체들은 old 영역으로 이동되는데 이를 aging이라고 한다.

### 성능 고려사항

가비지 컬렉션의 중요한 지표는 처리량과 지연시간이다.

- **처리량**

  가비지 컬렉션에 사용되지 않은 시간의 총 백분율

- **지연시간**

  지연시간은 애플리케이션이 얼마나 민감하게 반응하나이다. 가비지 컬렉션의 일시 정지는 애플리케이션의 민감성에 영향을 준다.

다른 지표로는 Footprint가 있는데, Footprint는 페이지와 캐시에서 측정되는 working set이다. 물리적 메모리가 제한되거나 많은 프로세스가 있는 환경에서는 Footprint가 확장성을 나타낼수 있다.

특정 세대의 크기를 설정하는 것은 이러한 고려사항의 균형이다. 예를 들어 young generation을 크게 설정하면 처리량을 높일수 있지만, footprint, 신속성, 중단 시간에 영향을 준다.

세대별 크기를 설정하는것에 정답은 없다. 최적의 선택은 애플리케이션이 메모리를 사용하는 방식과 사용자의 요구사항에 따라 달라진다. 가상머신의 가비지 컬렉터 선택은 항상 최선이 아니며 여러 명령 옵션으로 재정의 할 수 있다.