## 01 계층형 아키텍처의 문제는 무엇일까?

웹 -> 도메인 -> 영속성

계층을 잘 이해하고 구성한다면 웹 계층이나 영속성 계층에 독립적으로 도메인 로직을 작성할 수 있다.

잘 만들어진 계층형 계층형 아키텍처는 선택의 폭을 넓히고 변화하는 요구사항과 외부 요인에 빠르게 적응할 수 있게 해준다

하지만 계층형 아키텍처는 코드에 나쁜 습관들이 스며들기 쉽게 만들고 시간이 지날수록 소프트웨어를 점점 더 변경하기 어렵게 만드는 수많은 허점들을 노출한다

### 계층형 아키텍쳐는 데이터베이스 주도 설계를 유도한다

웹 계층은 도메인 계층에 의존하고, 도메인 계층은 영속성 계층에 의존하기 때문에 자연스레 데이터베이스에 의존하게된다

다른무엇보다도 도메인 로직을 먼저 만들어야 한다. 그래야만 우리가 로직을 제대로 이해 했는지 확인할 수 있다. 그리고 도메인 로직이 맞다는 것을 확인한 후에 이를 기반으로 영속성 계층과 웹 계층을 만들어야 한다.

데이터 중심적인 아키텍처가 만들어지는 가장 큰 원인은 ORM 프레임워크를 사용하기 때문이다. ORM에 의해 관리되는 엔티티들은 일반적으로 영속성 계층에 둔다.

영속성 계층과 도메인 계층 사이에 강한 결합이 생긴다. 서비스는 영속성 모델을 비즈니스 모델처럼 사용하게 되고 이로 인해 도메인 로직뿐만 아니라 영속성 계층과 관련된 작업들을 해야만 한다

### 지름길을 택하기 쉬워진다.

계층형 아키텍처에서 전체적으로 적용되는 규칙은 특정한 계층에서는 같은 계층에 있는 컴포넌트나 아래에 있는 계층만 접근 가능하다.

따라서 상위 계층에 위치한 컴포넌트에 접근해야 한다면 간단하게 컴포넌트를 계층 아래로 내려버리면 된다. 그러면 접근 가능하게 되고 깔끔하게 문제가 해결된다.

결과적으로 영속성 계층이 비대해진다.

### 테스트하기 어려워진다

계층형 아키텍처를 사용할 때 일반적으로 나타나는 변화의 형태는 계층을 건너뛰는 것이다

- 도메인 로직을 웹 계층에 구현하게된다.
- 웹 계층 테스트에서 도메인 계층뿐만 아니라 영속성 계층도 모킹해야 한다.

### 유스케이스를 숨긴다

기능을 추가하거나 변경할 적절한 위치를 찾는 일이 빈번하기 때문에 아키텍처는 코드를 빠르게 탐색하는 데 도움이되야 한다.

계층형 아키텍처는 도메인 로직이 여러 계층에 걸쳐 흩어지기 쉽다. (계층 아래로 내리기, 계층 넌너 뛰기) 이럴경우 새로운 기능을 추가할 적당한 위치를 찾는 일은 이미 어려워진 상태이다

### 동시 작업이 어려워진다

계층형 아키텍쳐에서는 이렇게 작업할 수 없다. 모든 것이 영속성 계층위에 만들어지기 때문에 영속성 계층을 먼저 개발해야 하고, 그다음에 도메인 계층을, 그리고 마지막으로 웹계층을 단들어야한다.

### 유지보수 가능한 소프트웨어를 만드는데 어떻게 도움이 될까?

계층형 아키텍처로 단들든 다른 아키텍처 스타일로 만들든, 계층형 아키텍처의 함정을 염두에 두면 지름길을 택하지 않고 유지보수하기에 더 쉬운 솔루션을 만드는 데 도움이 될것이다